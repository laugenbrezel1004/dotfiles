# Enable True color support
# Sets the default terminal type to support 256 colors for better color rendering
set -g default-terminal "tmux-256color"
# Allows terminals like xterm-256color to support true RGB colors for accurate theme display
set -ag terminal-overrides ",xterm-256color:RGB"
# Enables passthrough of escape sequences, allowing applications to control the terminal directly (e.g., for colors)
set -gq allow-passthrough on

# Set the prefix key to Ctrl+Space for triggering tmux commands
set-option -g prefix C-Space
# Disables a secondary prefix key, ensuring only Ctrl+Space is used
set-option -g prefix2 none

# Utility bindings
# Unbinds the default 'r' key to avoid conflicts
unbind r
# Binds 'r' to reload the .tmux.conf file, applying changes without restarting tmux
bind r source-file ~/.tmux.conf

# Unbinds the default '%' key for horizontal split
unbind %
# Binds '|' to split the window horizontally, opening the new pane in the current directory
bind | split-window -h -c "#{pane_current_path}"

# Unbinds the default '"' key for vertical split
unbind '"'
# Binds '-' to split the window vertically, opening the new pane in the current directory
bind - split-window -v -c "#{pane_current_path}"

# Unbinds the default 'v' key to avoid conflicts
unbind v
# Binds 'v' to enter copy mode, where text can be selected and copied
bind v copy-mode

# Resizing panes with hjkl (commented out to avoid conflicts with pane switching)
# Would resize the pane down by 5 cells with repeatable key presses
# bind -r j resize-pane -D 5
# Would resize the pane up by 5 cells with repeatable key presses
# bind -r k resize-pane -U 5
# Would resize the pane right by 5 cells with repeatable key presses
# bind -r l resize-pane -R 5
# Would resize the pane left by 5 cells with repeatable key presses
# bind -r h resize-pane -L 5

# Pane switching with leader + hjkl
# Binds 'h' to move focus to the pane to the left after pressing Ctrl+Space
bind h select-pane -L
# Binds 'j' to move focus to the pane below after pressing Ctrl+Space
bind j select-pane -D
# Binds 'k' to move focus to the pane above after pressing Ctrl+Space
bind k select-pane -U
# Binds 'l' to move focus to the pane to the right after pressing Ctrl+Space
bind l select-pane -R

# Maximize panes
# Binds 'm' to toggle zooming (maximize/restore) the current pane, repeatable
bind -r m resize-pane -Z

# Mouse support
# Enables mouse interactions, allowing clicking to switch panes, resize panes, and scroll in copy mode
set -g mouse on

# Vim shell navigations and selects in tmux panes
# Sets copy mode to use Vim keybindings for navigation (e.g., h/j/k/l, w/b for words)
set-window-option -g mode-keys vi
# In copy mode, binds 'v' to start selecting text, similar to Vim's visual mode
bind-key -T copy-mode-vi 'v' send -X begin-selection
# In copy mode, binds 'y' to copy the selected text to tmux's internal clipboard and exit copy mode
bind-key -T copy-mode-vi 'y' send -X copy-selection

# Drag copy using mouse
# Disables automatic copying when dragging with the mouse in copy mode, requiring explicit 'y' to copy
unbind -T copy-mode-vi MouseDragEnd1Pane

# Tmux plugin manager
# Sets the path where tmux plugins are stored
set-environment -g TMUX_PLUGIN_MANAGER_PATH ~/.config/tmux/.tmux/plugins
# Specifies the tmux plugin manager (TPM), which must be listed first to initialize plugins
set -g @plugin 'tmux-plugins/tpm'
# Adds vim-tmux-navigator plugin for seamless navigation between tmux panes and Vim splits using Ctrl+h/j/k/l
# set -g @plugin "christoomey/vim-tmux-navigator"
# Adds tmux-sessionx plugin for an enhanced session switcher, activated with prefix + o
set -g @plugin 'omerxx/tmux-sessionx'
# Adds tmux-resurrect plugin to save and restore tmux sessions after a system restart
set -g @plugin "tmux-plugins/tmux-resurrect"
# Adds tmux-continuum plugin to automatically save tmux sessions every 15 minutes
set -g @plugin "tmux-plugins/tmux-continuum"
# Adds catppuccin/tmux plugin for a customizable, visually appealing theme
set -g @plugin 'catppuccin/tmux'

# Configures tmux-sessionx to use 'o' as the activation keybinding (prefix + o)
set -g @sessionx-bind 'o'
# Enables tmux-resurrect to save pane contents, restoring open files and commands
set -g @resurrect-capture-pane-contents "on"
# Enables tmux-continuum to automatically restore the last saved session on tmux startup
set -g @continuum-restore "on"

# Configure Catppuccin theme
# Sets the Catppuccin theme flavor to "mocha" for a dark, warm color scheme
set -g @catppuccin_flavor "mocha"
# Disables the status bar background to make it transparent
set -g @catppuccin_status_background "none"
# Removes extra styling from window status to keep it minimal
set -g @catppuccin_window_status_style "none"
# Disables pane status display to reduce clutter
set -g @catppuccin_pane_status_enabled "off"
# Disables pane border status to keep borders clean
set -g @catppuccin_pane_border_status "off"

# Status bar left look and feel
# Sets the maximum length of the left status bar to 100 characters
set -g status-left-length 100
# Initializes the left status bar as empty before appending components
set -g status-left ""
# Conditionally styles the session name: red background when prefix is active, green otherwise
set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_red},fg=#{@thm_bg},bold]  #S },#{#[bg=#{@thm_bg},fg=#{@thm_green}]  #S }}"
# Adds a separator with a neutral color
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"
# Displays the current command running in the pane (e.g., zsh, vim) with a maroon icon
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_maroon}]  #{pane_current_command} "
# Adds another separator
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]│"
# Shows the current directory, shortened to 32 characters, replacing $USER with ~ for home
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_blue}]  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "
# Adds a separator only if the pane is zoomed
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_overlay_0},none]#{?window_zoomed_flag,│,}"
# Displays a yellow zoom indicator if the pane is zoomed
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_yellow}]#{?window_zoomed_flag,  zoom ,}"

# Status bar right look and feel
# Sets the maximum length of the right status bar to 100 characters
set -g status-right-length 100
# Initializes the right status bar as empty before appending components
set -g status-right ""
# Displays battery status with a red background if below 10%, green otherwise
set -ga status-right "#{?#{e|>=:10,#{battery_percentage}},#{#[bg=#{@thm_red},fg=#{@thm_bg}]},#{#[bg=#{@thm_bg},fg=#{@thm_green}]}} #{battery_icon_status} #{battery_percentage} "
# Shows the date (YYYY-MM-DD) and time (HH:MM) with a blue color
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_blue}] 󰭦 %Y-%m-%d 󰅐 %H:%M "

# Configure Tmux status bar
# Positions the status bar at the bottom of the screen
set -g status-position top
# Sets the status bar background to the Catppuccin theme's background color
set -g status-style "bg=#{@thm_bg}"
# Centers the window list in the status bar for balanced appearance
set -g status-justify "absolute-centre"

# Pane border look and feel
# Displays pane borders at the top (though format is empty, so no text is shown)
setw -g pane-border-status top
# Sets an empty pane border format to avoid displaying titles
setw -g pane-border-format ""
# Styles the active pane's border with a neutral foreground color
setw -g pane-active-border-style "bg=#{@thm_bg},fg=#{@thm_overlay_0}"
# Styles inactive pane borders with a slightly darker foreground color
setw -g pane-border-style "bg=#{@thm_bg},fg=#{@thm_surface_0}"
# Uses single-line borders for panes (e.g., - instead of double lines)
setw -g pane-border-lines single

# Window look and feel
# Automatically renames windows based on the running command
set -wg automatic-rename on
# Sets the window name format to the current command (e.g., zsh, vim)
set -g automatic-rename-format "#{pane_current_command}"

# Formats inactive windows in the status bar: shows index and name (if not "Window")
set -g window-status-format " #I#{?#{!=:#{window_name},Window},: #W,} "
# Styles inactive windows with a rosewater foreground color
set -g window-status-style "bg=#{@thm_bg},fg=#{@thm_rosewater}"
# Styles the last active window similarly to inactive windows
set -g window-status-last-style "bg=#{@thm_bg},fg=#{@thm_rosewater}"
# Highlights windows with activity (e.g., output) with a red background
set -g window-status-activity-style "bg=#{@thm_red},fg=#{@thm_bg}"
# Highlights windows with a bell (e.g., notification) with a bold red background
set -g window-status-bell-style "bg=#{@thm_red},fg=#{@thm_bg},bold"
# Sets the separator between windows in the status bar to a neutral-colored pipe
set -gF window-status-separator "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}]│"
# Formats the current window: shows index and name, styled differently
set -g window-status-current-format " #I#{?#{!=:#{window_name},Window},: #W,} "
# Styles the current window with a bold blue background for emphasis
set -g window-status-current-style "bg=#{@thm_blue},fg=#{@thm_bg},bold"

# Runs the Tmux Plugin Manager (TPM) to load all specified plugins
# Must be the last line to ensure plugins are initialized after all settings
run '~/.config/tmux/.tmux/plugins/tpm/tpm'
